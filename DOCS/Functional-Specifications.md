# Ֆունկցիոնալ պահանջների փաստաթուղթ (Functional Specifications)

## 1) Նպատակ և համատեքստ
**Guard Alarm / Guardia Proto** համակարգը պրոտոտիպ է՝ նախատեսված օպերատորների/դիսպետչերների համար՝ Երևան քաղաքի պահպանության օբյեկտների **տագնապների**, **կարգախմբերի**, **զանգերի**, և **քարտեզային դիտարկման** կառավարումը ցուցադրելու նպատակով։

Պրոտոտիպը աշխատում է **mock տվյալներով** (առանց backend), ցուցադրում է հիմնական հոսքերը և UI/UX վարքագծերը։

## 2) Դերեր և իրավունքներ
Պրոտոտիպում դերային մոդել/ավտենտիկացիա չի իրականացվում, բայց գործառույթները նախագծված են հետևյալ դերերի համար․
- **Օպերատոր/Դիսպետչեր**: դիտում/ֆիլտրում է տագնապները, նշանակում է կարգախումբ, կատարում է զանգեր, փակում է տագնապը, դիտում է պատմությունները։
- **Ադմին/Կարգավորող**: կառավարում է օբյեկտները, կարգախմբերը, մեքենաները, բաժինները, օբյեկտների տեսակները։

## 3) Սահմանումներ և հիմնական հասկացություններ
- **Օբյեկտ (Facility)**՝ պահպանվող օբյեկտ (խանութ, դպրոց, բանկ և այլն)՝ հասցեով, կոնտակտներով և վիճակներով։
- **Տագնապ (Alarm)**՝ օբյեկտից ստացված իրադարձություն (օր․ լուռ տագնապ, հոսանքազրկում, կապի խզում)։
- **Կարգախումբ (Unit)**՝ արձագանքող խմբավորում՝ տեղորոշմամբ, հերթափոխային վիճակով և անձնակազմով։
- **Զանգ (Call/Call Record)**՝ օպերատորի կողմից մուտքագրված/ստացված զանգի գրառում՝ հնարավոր ձայնագրությամբ։
- **Պահպանության տակ / Հանված է պահպանությունից**՝ օբյեկտի զինված վիճակ (`isArmed`)։

## 4) Տվյալների մոդել (բարձր մակարդակով)
Պրոտոտիպում կիրառվում են հետևյալ հիմնական կառուցվածքները (տես՝ `types.ts`)․
- **Facility**: `id`, `name`, `type`, `department`, `address`, `coordinates(lat,lng)`, `contactPerson`, `phones[]`, `isArmed`, `connectionStatus`, `activeAlarmId?`, `schedule`, `password`, `isArchived?`
- **Alarm**: `id`, `status` (օր․ RECEIVED/ACTIVE/FINISHED/FALSE_ALARM), `timestamp`, `type`, `facilityCode/name`, `address`, `department`, `contactPerson`, `contactPhones[]`, `coordinates`, `unitActions[]`, `callHistory[]`, `facilityPassword?`
- **Unit**: `id`, `name`, `department`, `coordinates`, `shiftStatus` (ON_DUTY/BREAK/ALARM/OFF_DUTY), անձնակազմ/սարքավորումներ և այլն
- **UnitAction**: `unitName`, `action`, `actionType`, `timestamp`
- **CallRecord / CallLog**: `id`, `timestamp`, `phoneNumber`, `operatorName`, `durationSec`, `recordingUrl` (դեմո/իրական), հավելյալ մետատվյալներ ըստ էջի
- **SecurityLog**: անվտանգության գործողությունների լոգեր
- **SecurityDepartment / FacilityTypeDefinition / ServiceVehicle**: կարգավորումների էությունները

## 5) Նավիգացիա և ընդհանուր UI
### 5.1 Կողային ընտրացանկ (Sidebar)
- Ցուցադրում է հիմնական բաժինները՝
  - **Տագնապներ/Զգուշացումներ**
  - **Պահպանության քարտեզ**
  - **Կարգախմբեր**
  - **Զանգեր**
  - **Պահպանության լոգեր**
  - **Կարգավորումներ** (ենթաբաժիններով)
- **Փակվող/բացվող** ընտրացանկ՝ պահպանելով վիճակը `localStorage`-ում։
- Բրենդավորում՝ վերնագրում/ենթավերնագրում հայերեն անվանումներով։

### 5.2 Հիշեցումներ (Toast)
- Համակարգը ցուցադրում է toaster հաղորդագրություններ գործողությունների վերաբերյալ (օր․ դեմո զանգի մեկնարկ)։

## 6) Գործառույթներ ըստ էկրանների

## 6.1 Տագնապներ/Զգուշացումներ (հիմնական էջ)
### Նպատակ
Օպերատորը վերահսկում է տագնապների հոսքը, դիտում մանրամասներ և կատարում օպերատիվ գործողություններ։

### Ֆունկցիոնալություն
- **Տագնապների ցուցակ**՝ աղյուսակով
- **Որոնում**՝ ըստ օբյեկտի անվան, կոդի, հասցեի և այլն
- **Ֆիլտրեր**՝ ըստ բաժնի/տեսակի/կարգավիճակի և ժամանակահատվածի
- **Կեղծ տագնապ** (`FALSE_ALARM`) տարբերակում
  - Տագնապի փակման ժամանակ պատճառի ընտրությամբ, եթե ընտրվում է **Կեղծ տագնապ**, ապա կարգավիճակը դառնում է `FALSE_ALARM`
  - Աղյուսակում **տեսողական տարբերակում** և **ֆիլտրում** `FALSE_ALARM` կարգավիճակով

### Տագնապի մանրամասների վահանակ (աջ կողմի panel)
Վահանակը պարունակում է հատվածներ (accordion)՝
- **Կարգախմբերի գործողություններ**
- **Կոնտակտային տվյալներ**
- **Զանգերի պատմություն**

#### 6.1.1 Կարգախմբերի գործողություններ
- Ցուցադրում է կարգախմբերի գործողությունների ժամանակագրությունը (ստանալ/ընդունել/մերժել/ժամանել/ավարտել և այլն)
- Դիզայնը նախատեսված է **կոմպակտ** ներկայացման համար՝ չկորցնելով ինֆորմացիան

#### 6.1.2 Կոնտակտային տվյալներ
- Ցուցադրում է կոնտակտային անձին և հեռախոսահամարները
- Յուրաքանչյուր հեռախոսահամարի համար կա **Զանգ** կոճակ
- UI-ը կոմպակտացված է և **header-ների** (3 accordion) ոճը միասնական է՝ նույն բարձրություն/պադինգ/սիմվոլների չափ

#### 6.1.3 Զանգերի պատմություն
- Ցուցադրում է տագնապի հետ կապված զանգերի գրառումները
- Յուրաքանչյուր գրառում ունի **ձայնագրության նվագարկիչ** (waveform)
- Տևողության badge-ը ցուցադրում է՝
  - միայն ընդհանուր տևողություն՝ մինչ նվագարկումը
  - **անցած / ընդհանուր**՝ նվագարկելիս և pause-ից հետո էլ՝ անցածը չի անհետանում
- **Միաժամանակ միայն մեկ** ձայնագրություն կարող է նվագարկվել. նորի play-ը ավտոմատ pause է անում ընթացիկը

### Գործողություններ
- **Կարգախմբի կցում/փոխում** (մոդալ/ընտրիչով)
- **Տագնապի փակում**՝ պատճառի ընտրությամբ (ներառյալ՝ Կեղծ տագնապ)
- **Զանգ կատարել**՝ կոնտակտային համարին (դեմո հոսք)

## 6.2 Պահպանության քարտեզ (Security Map)
### Նպատակ
Քարտեզով տեսնել օբյեկտների և կարգախմբերի դիրքերը, վիճակները, և արագ գործել։

### Ֆունկցիոնալություն
- MapLibre քարտեզ (Carto basemap)
- **Օբյեկտների marker-ներ**՝ գույներով ըստ վիճակի
  - Alarm active → կարմիր
  - Warning → դեղին
  - Normal → կանաչ
  - Offline → մոխրագույն
- **Կարգախմբերի marker-ներ**՝ ըստ հերթափոխային վիճակի և GPS/WiFi կորուստների նշումներով
- Marker click → բացում է մանրամասների քարտը
- Sidebar list (Օբյեկտներ/Կարգախմբեր)՝ բաժիններով խմբավորված, որոնմամբ

### Օբյեկտների ցուցակ (sidebar list)՝ վիճակի իկոնա
Յուրաքանչյուր օբյեկտի համար ցուցադրվում է՝
- **Lock/Unlock** իկոնա՝ `isArmed` հիմքով
  - Lock = **Պահպանության տակ**
  - Unlock = **Հանված է պահպանությունից**
- Կողքին պահպանվում է նաև **գունավոր dot**-ը (online/offline/alarm/warning)

### Զանգի կոճակ
Քարտեզի մանրամասների վահանակում կոնտակտային համարների կողքին կա **Call** իկոնա։
Պրոտոտիպում այն **չի բացում արտաքին `tel:`** (չպետք է հայտնվի “Open external link” prompt), այլ կանչում է ներհամակարգային դեմո հոսքը։

## 6.3 Զանգեր (Calls)
### Նպատակ
Դիտել զանգերի լոգերը, որոնել և լսել ձայնագրություններ (դեմո)։

### Ֆունկցիոնալություն
- Զանգերի աղյուսակ, ֆիլտրեր/որոնում
- Որոնման դաշտը **չի ունենում նախնական ավտոլրացվող արժեք**
- Waveform նվագարկիչ՝
  - play/pause
  - **միայն մեկ** ձայնագրություն միաժամանակ
  - դեմո ձայնի նվագարկում (կախված `recordingUrl`-ից/ֆոլբեք մեխանիզմից)

## 6.4 Պահպանության լոգեր (Security Logs)
- Գործողությունների/իրադարձությունների ցուցադրում ըստ timestamp-ի
- Որոնում/ֆիլտրում ըստ բաժնի/օբյեկտի/գործողության տեսակի (պրոտոտիպի մակարդակով)

## 6.5 Կարգավորումներ
### 6.5.1 Պահպանության բաժիններ (Departments)
- CRUD՝ բաժինների ցանկի կառավարում

### 6.5.2 Պահպանվող օբյեկտներ (Facilities Management)
- Աղյուսակով օբյեկտների կառավարում
- Կոնտակտային դաշտում կարող են ցուցադրվել **մի քանի հեռախոսահամարներ**
- Յուրաքանչյուր հեռախոսահամարի կողքին կա **Call** իկոնա (դեմո զանգ)
- Add/Edit օբյեկտի մոդալ (`FacilityFormModal`)
  - **Գաղտնաբառ** դաշտը լռելյայն **թաքցված** է, կա show/hide
  - **Հասցեի ընտրություն քարտեզից** (`AddressSelectorModal` + MapLibre)
    - քարտեզի վրա click → նշվում է կետ, ցուցադրվում է ընտրած հասցե/կոորդինատներ (դեմո reverse-geocode)
    - “Ընտրել” → լրացնում է form-ի հասցեն և պահպանում է `coordinates(lat,lng)`

### 6.5.3 Կարգախմբեր (Units Management)
- CRUD՝ կարգախմբերի տվյալների կառավարում
- Հերթափոխային վիճակներ, անձնակազմ, մեքենայի կապակցում (պրոտոտիպային)

### 6.5.4 Մեքենաներ (Vehicles)
- CRUD՝ ծառայողական մեքենաների կառավարում

### 6.5.5 Օբյեկտների տեսակներ (Facility Types)
- CRUD՝ օբյեկտների տեսակների կառավարում

## 7) Դեմո/պրոտոտիպային սահմանափակումներ
- Չկա backend, տվյալները չեն պահպանվում սերվերում (միայն հիշողության մեջ/մոկ)
- Զանգը և ձայնագրությունը **դեմո են** (իրական հեռախոսակապ/VoIP չի իրականացվում)
- Reverse geocoding-ը կարող է լինել mock/placeholder (կախված իրականացումից)
- Ավտենտիկացիա/իրավունքներ՝ չկա

## 8) Ոչ ֆունկցիոնալ պահանջներ (NFR)
- **Լեզու**՝ Հայերեն
- **Արձագանքողականություն**՝ հիմնական էկրանները աշխատում են desktop լայնությունների համար, ցանկալի է պահպանել ընթեռնելիություն փոքր լայնությունների դեպքում
- **Կայունություն**՝ UI-ը չպետք է crash անի՝ հատկապես քարտեզային մոդալների/կոորդինատների բացակայության դեպքում
- **Օգտագործելիություն**՝
  - հստակ ֆիդբեք (toast) գործողությունների ժամանակ
  - մեկ աուդիո միաժամանակ՝ կանխելու համար խառնաշփոթը

## 9) Ապագա ընդլայնումներ (առաջարկ)
- Իրական backend + persistence
- Role-based access control
- Իրական telephony/VoIP ինտեգրում + իրական ձայնագրություններ
- Իրական reverse geocoding (Nominatim/Google/այլ) և հասցեների ավտոլրացում
- Audit log-երի ամբողջականություն և արտահանում


